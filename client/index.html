<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="css/stylesheet.css">
    <title>Telemetry</title>
</head>
</head>

<body>
    <!-- Titlebaar contains the title of the webapp -->
    <div id="Titlebar">
        <img src="img/logo.png" alt="UBC Solar Logo" id="Titlebar-Emblem-SolarLogo">

        <table id="Titlebar-table">
            <tr>
                <td>
                    <h2 class="Titlebar-mainheader">Telemetry Interface for Daybreak</h2>
                </td>
            </tr>
        </table>
    </div>

    <!-- Sidebar contains the most critical information -->
    <div id="SideNav">

        <div id="SideNav-Emblem">
            <!--
            <img src="Solar_Logo.png" alt="UBC Solar Logo" id="SideNav-Emblem-Solarlogo">
            -->
            <h2 class="SideNav-mainheader">Vehicle Dashboard</h2>
        </div>

        <!-- Communications status -->

        <div id="SideNav-Communications">
            <h3 class="SideNav-header"> Communciations</h3>
            <table class="SideNav-table">
                <tr>
                    <td>Server Status: </td>
                    <td id="server-status">Disconnected</td>
                </tr>
                <tr>
                    <td>Timestamp: </td>
                    <td id="last-timestamp">-</td>
                </tr>
                <tr>
                    <td>Message ID: </td>
                    <td id="last-id">-</td>
                </tr>
                <tr>
                    <td>Radio RSSI (dbm): </td>
                    <td>-</td>
                </tr>
                <tr>
                    <td>Cell RSSI (dbm): </td>
                    <td>-</td>
                </tr>
            </table>
        </div>


        <!-- Summary of battery status -->
        <div id="SideNav-BatterySummary">
            <h3 class="SideNav-header">Battery Summary</h3>
            <table class="SideNav-table">
                <tr>
                    <td>Pack Voltage</td>
                    <td id="batt-voltage">000.0</td>
                    <td>V</td>
                </tr>
                <tr>
                    <td>Min. Cell Voltage</td>
                    <td id="batt-min-cell-voltage">000.0</td>
                    <td>V</td>
                </tr>
                <tr>
                    <td>Max. Cell Voltage</td>
                    <td id="batt-max-cell-voltage">000.0</td>
                    <td>V</td>
                </tr>
                <tr>
                    <td>Pack Current</td>
                    <td id="batt-current">000.0</td>
                    <td>A</td>
                </tr>
                <tr>
                    <td>Max. Temperature</td>
                    <td id="batt-max-temp">000.0</td>
                    <td>C</td>
                </tr>
                <tr>
                    <td>Min. Temperature</td>
                    <td id="batt-min-temp">000.0</td>
                    <td>C</td>
                </tr>
                <tr>
                    <td>Ave. Temperature</td>
                    <td id="batt-ave-temp">000.0</td>
                    <td>C</td>
                </tr>
                <tr>
                    <td>State of Charge</td>
                    <td id="batt-soc">000.0</td>
                    <td>%</td>
                </tr>
                <tr>
                    <td>Supp. Voltage</td>
                    <td id="batt-supp-voltage">000.0</td>
                    <td>V</td>
                </tr>
            </table>
        </div>

        <!-- Summary of motor status -->
        <div id="SideNav-MotorSummary">
            <h3 class="SideNav-header">Motor Summary</h3>
            <table class="SideNav-table">
                <tr>
                    <td>Speed</td>
                    <td id="motor-velocity">000.0</td>
                    <td>km/h</td>
                </tr>
                <tr>
                    <td>Current</td>
                    <td id="motor-current">000.0</td>
                    <td>A</td>
                </tr>
                <tr>
                    <td>Voltage</td>
                    <td id="motor-voltage">000.0</td>
                    <td>V</td>
                </tr>
                <tr>
                    <td>Temperature</td>
                    <td id="motor-temp">000.0</td>
                    <td>C</td>
                </tr>
                <tr>
                    <td>Heatsink</td>
                    <td id="mc-temp">000.0</td>
                    <td>C</td>
                </tr>

            </table>
        </div>

        <!-- Enumeration of most crucial battery faults-->
        <div id="SideNav-BatteryFaults">
            <h3 class="SideNav-header">Battery Faults</h3>
            <table class="SideNav-table">
                <tr>
                    <td id="battery-low">Battery Low</td>
                    <td id="battery-full">Battery Full</td>
                    <td id="comm-fault">Comm. Fault</td>
                </tr>
                <tr>
                    <td id="chg-overcurrent">Charge Overcurrent</td>
                    <td id="dchg-overcurrent">Discharge Overcurrent</td>
                    <td id="overtemp">Overtemperature</td>

                </tr>
                <tr>
                    <td id="undervoltage">Undervoltage</td>
                    <td id="overvoltage">Overvoltage</td>
                    <td id="general-fault">General Fault</td>
                </tr>
            </table>
        </div>

    </div>

    <div id="GraphNav">

        <!--
        - Battery Temperature
        - Motor Temperature
        - Speed
        - Motor Current + Pack Current
        -->

        <div id="GraphNav-Title">
            <h1>Time Series Graphs</h1>
        </div>

        <div id="GraphNav-Temp">
            <h5> Temperature time-series</h5>
            <canvas id="tempChart" width="100%" height="50%"></canvas>
        </div>

        <div id="GraphNav-Speed">
            <h5> Voltage and Current time-series</h5>
            <canvas id="vAndAChart" width="100%" height="70%"></canvas>
        </div>


    </div>

    <!-- Tabs -->
    <script type="text/javascript" src="js/tabs.js"></script>
    <div id="tabs">

        <button class="tablink" onclick="openPage('Faults', this, '#A3C4BC')" id="defaultOpen">
            <h3>Other Faults</h3>
        </button>
        <button class="tablink" onclick="openPage('Maps', this, '#A3C4BC')" id="map-tab">
            <h3>Maps</h3>
        </button>
        <button class="tablink" onclick="openPage('History', this, '#A3C4BC')" id="history-tab">
            <h3>History</h3>
        </button>
    </div>

    <!-- Battery Tab -->
    <div id="Faults" class="tabcontent">

        <!-- BMS State -->
        <div id="Faults-bmsState">
            <h3 class="Faults-header">BMS State</h3>
            <table class="tab-table">
                <tr>
                    <td id="relay-fault">Relay Fault</td>
                    <td id="k3-contactor">K3 Contactor On</td>
                    <td id="k2-contactor">K2 Contactor On</td>
                </tr>
                <tr>
                    <td id="k1-contactor">K1 Contactor On</td>
                    <td id="fault-state">Fault State</td>
                    <td> - </td>
                </tr>
            </table>
        </div>

        <!-- Other Battery Fault Codes -->
        <div id="Faults-batteryFault">
            <h3 class="Faults-header">Battery Faults</h3>
            <table class="tab-table">
                <tr>
                    <td id="fan-on">Fan On</td>
                    <td id="llim-set">LLIM Set</td>
                    <td id="hlim-set">HLIM Set</td>
                </tr>
                <tr>
                    <td id="can-contactor">CAN Contactor Request</td>
                    <td id="hardwire-contactor">Hardwire Contactor Request</td>
                    <td id="interlock-tripped">Interlock Tripped</td>
                </tr>
                <tr>
                    <td id="load-power">Power from Load</td>
                    <td id="source-power">Power from Source</td>
                    <td> - </td>
                </tr>
            </table>
        </div>

        <!-- Battery Warning Flags -->
        <div id="Faults-batteryWarning">
            <h3 class="Faults-header">Battery Warning</h3>
            <table class="tab-table">
                <tr>
                    <td id="isolation-fault">Isolation Fault</td>
                    <td id="low-soh">Low SOH</td>
                    <td id="hot-temp">Hot Temperature</td>
                </tr>
                <tr>
                    <td id="cold-temp">Cold Temperature</td>
                    <td id="high-voltage">High Voltage</td>
                    <td id="low-voltage">Low Voltage</td>
                </tr>
            </table>
        </div>

        <!-- Motor Warnings -->
        <div id="Faults-motorWarning">
            <h3 class="Faults-header">Motor Warning</h3>
            <table class="tab-table">
                <tr>
                    <td id="voltage-lockout">Voltage Lock-out</td>
                    <td id="config-error">Configuration Error</td>
                    <td id="watchdog-reset">Watchdog Reset</td>
                </tr>
                <tr>
                    <td id="dc-overvoltage">DC Over-voltage</td>
                    <td id="software-overcurrent">Software Over-current</td>
                    <td id="hardware-overcurrent">Hardware Over-current</td>
                </tr>
            </table>
        </div>

    </div>

    <div id="Maps" class="tabcontent">

        <!--Weather at current location and time-->


        <!--Spatial Map with Location-->
        <div id="googleMap" style="width:100%;height:40%"></div>

        <!-- Google Maps API: replace KEY_HERE with your API keys                    -->
        <!-- https://developers.google.com/maps/documentation/javascript/get-api-key -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCPgIT_5wtExgrIWN_Skl31yIg06XGtEHg&callback=myMap"
            async defer></script>

        <!--Elevation Map with Location-->
        <canvas id="elevationChart" width="100%" height="40%"></canvas>

        <table width="100%">
            <tr>
                <td>Current Time:</td>
                <td id="current-time">-</td>
            </tr>
            <tr>
                <td>Sunrise:</td>
                <td id="sunrise-time">-</td>
            </tr>
            <tr>
                <td>Sunset:</td>
                <td id="sunset-time">-</td>
            </tr>
        </table>

        <table width="100%">
            <tr>
                <td>Time</td>
                <td>Temp(C)</td>
                <td>Cloud(%)</td>
                <td>Wind(m/s + dir)</td>
                <td>Description</td>
            </tr>
            <tr>
                <td>+0</td>
                <td id="temp-0"> - </td>
                <td id="cloud-0"> - </td>
                <td id="wind-0"> - </td>
                <td id="desc-0"> - </td>
            </tr>
            <tr>
                <td>+3</td>
                <td id="temp-3"> - </td>
                <td id="cloud-3"> - </td>
                <td id="wind-3"> - </td>
                <td id="desc-3"> - </td>
            </tr>
            <tr>
                <td>+6</td>
                <td id="temp-6"> - </td>
                <td id="cloud-6"> - </td>
                <td id="wind-6"> - </td>
                <td id="desc-6"> - </td>
            </tr>
        </table>

    </div>

    <div id="History" class="tabcontent">
        <div class="container">
            <p>Fetch the history data</p>
        <form  action="/history" method="post">
            <div class="form-group">
                <label for="data-name">Data Name:  </label>
                <select id="data-name" name="dataName">
                    <option value="All">All</option>
                    <option value="battery-faults">Battery Faults</option>
                    <option value="battery-voltage">Battery Voltage</option>
                    <option value="battery-current">Battery Current</option>
                    <option value="battery-soc">Battery Soc</option>
                    <option value="battery-temperature">Battery Temperature</option>
                    <option value="motor-faults">Motor Faults</option>
                    <option value="motor-power">Motor Power</option>
                    <option value="motor-velocity">Motor Velocity</option>
                    <option value="motor-temperature">Motor Temperature</option>
                </select>
            </div>
            <div class="form-group">
                <label for="time-stamp">Time Stamp:</label>
                <input id="time-stamp" type="number" name="timeStamp">
            </div>
            <button type="submit" class="btn">Go Fetch</button>
        </form>
        </div>
        

    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.js"></script>
    <script type="text/javascript" src="js/map.js"></script>
    <script src="js/tabs.js"></script>
    
</body>

</html>